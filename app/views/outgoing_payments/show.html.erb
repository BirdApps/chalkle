<%= render partial: 'fancy_header', locals: { fancy_title: "Remittance ##{@outgoing_payment.id}" } %>

<div class="row">
  <% @outgoing_payment.courses.order(:start_at).each do |course| %>
    <% next unless course.has_income? %>

    <div class="col-xs-12 col-lg-10 col-lg-offset-1 col-xl-8 col-xl-offset-2">
      
      <div class="row">
        <%= render partial: 'fancy_header', locals: { fancy_title: "SALES", small: true } %>

        <div class="col-xs-12 col-md-9">
          <%= link_to provider_course_path(course.path_params) do %>
            <h4 class="flush"><%= course.name %></h4>
          <% end %>
        </div>
        <div class="col-xs-12 col-md-3 text-right">
          <small><%= day_ordinal_month course.start_at, false, true %></small>
        </div>
        <div class="col-xs-12 pad-top-10">
          <div class="row">
            <% course.bookings.map(&:paid).uniq.each do |amount| %>
              <div class="col-xs-9">
                Bookings @ <%= number_to_currency amount %>
              </div>
              <div class="col-xs-3 text-right"> 
                <%= course.bookings.select{|b| b.paid == amount}.count %> 
              </div>
            <% end %>
          </div>
        </div>
        <div class="col-xs-12 pad-top-10">
          <div class="odd row pad-top-10 pad-bottom-10">
            
            <div class="col-xs-6">
              <div class="upper strong">
                Total Sales
              </div>
            </div>

            <div class="col-xs-6 text-right">
              <div class="strong">
                <%= number_to_currency @outgoing_payment.total_sales_for_course(course) %>
              </div>
            </div>

            <% if @outgoing_payment.tax.present? %>
              <div class="col-xs-12 text-right">
                <small>
                  Includes GST of <%= number_to_currency @outgoing_payment.tax_for_course(course) %>
                </small>
              </div>
            <% end %>

          </div>
        </div>
      </div>

      <div class="row">
        <%= render partial: 'fancy_header', locals: { fancy_title: "PLATFORM COSTS", small: true } %>
        
        <div class="col-xs-8">
          Processing fees
        </div>
        <div class="col-xs-4 text-right">
          <%= number_to_currency @outgoing_payment.processing_fees_for_course(course) %>
        </div>

        <div class="col-xs-8">
          Booking fees
        </div>
        <div class="col-xs-4 text-right">
          <%= number_to_currency @outgoing_payment.booking_fees_for_course(course) %>
        </div>

        <% if @outgoing_payment.platform_tax_for_course(course) != 0 %>
          <div class="col-xs-8">
            <small>GST</small>
          </div>
          <div class="col-xs-4 text-right">
            <small>
              <%= number_to_currency @outgoing_payment.platform_tax_for_course(course) %>
            </small>
          </div>
        <% end %>

        <div class="col-xs-12 pad-top-10">
          <div class="odd row pad-top-10 pad-bottom-10">
            
            <div class="col-xs-6">
              <div class="upper strong">
                Total Platform Costs
              </div>
            </div>

            <div class="col-xs-6 text-right">
              <div class="strong">
                <%= number_to_currency @outgoing_payment.platform_fees_for_course(course) %>
              </div>
            </div>

            <% if @outgoing_payment.tax.present? %>
              <div class="col-xs-12 text-right">
                <small>
                  + GST <%= number_to_currency @outgoing_payment.platform_tax_for_course(course) %>
                </small>
              </div>
            <% end %>

          </div>
        </div>

      </div>



      <div class="row">
        <%= render partial: 'fancy_header', locals: { fancy_title: "REMITTANCE", small: true } %>
        
      </div>

    </div>

  <% end %>
</div>