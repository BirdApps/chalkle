- title @lesson.name

.page_header_panel
  .container
    %h1.page-title
      - if chalkler_signed_in?
        = "Welcome #{current_chalkler.name}"
      - else
        = "Welcome to chalkleÂ°"
.main_panel.container
  .row.with_browse_sidebar
    #weeks.browse_sidebar.col-sm-3.col-md-4.hidden-xs
      %a.sidebar_top_nav{href: channel_lessons_path(@channel)}
        %i.icon-calendar
        Return to Calendar
      = render partial: 'weeks_calendar_view', locals: {week_lessons: @week_lessons}
    .col-sm-9.col-md-8.lesson_panel
      .masthead
        .masthead_contents
          -if @lesson.lesson_upload_image.url.present?
            =image_tag @lesson.lesson_upload_image.url(:large).to_s, alt: @lesson.name, class: 'lesson-image uploaded-lesson-image'
          %h2= @lesson.name

      .row.lesson-details
        .col-md-8.content-left
          .lesson-description
            %h3 What we are doing
            = simple_format @lesson.do_during_class
            %h3 What you will learn
            = simple_format @lesson.learning_outcomes
            %h6 Note
            = "We require a minimum of #{@lesson.min_attendee} people for this class to go ahead. If the minimum number of attendees is not reached, a decision to cancel will be made 3 days before the class. If the class is cancelled, you will be notified via email with refund instructions."
        .col-md-4.content-right
          .booking-actions
            - if chalkler_signed_in?
              - if current_chalkler.lessons.where{bookings.status.eq 'yes'}.exists? @lesson
                %p.text-success
                  %strong You are attending
              - elsif @lesson.bookable?
                .btn.btn-primary= link_to 'Join this class', new_channel_lesson_booking_path(@channel, @lesson), :id => 'join-lesson'
            - elsif @lesson.bookable?
              .btn.btn-primary= link_to 'Join this class', new_channel_lesson_booking_path(@channel, @lesson), :id => 'join-lesson'

          = render :partial => 'lesson_details', :locals => { :lesson => @lesson }
          = render :partial => 'teacher_details', :locals => { :lesson => @lesson }

:coffeescript
  signedIn = () ->
    if _.isString(_.find(document.cookie.split('; '), (a)-> return a == 'signed_in=1')) then true else false

  $('#join-lesson').click (e)->
    unless signedIn()
      e.preventDefault()

  unless signedIn()
    $('#join-lesson').popover
      placement: 'top'
      html: true
      title: 'Sign in to join a class'
      content: 'Please <a href="/chalklers/sign_in">sign in</a> or <a href="/chalklers/sign_up">create an account</a> to make a booking.'

  $('.with_browse_sidebar').equalize({equalize: 'min-height', reset: true});
