<div class="new_form_wrapper new_booking">
  <div class="col-xs-12 col-md-8 col-md-offset-2 col-md-inset-2">
    <p><%= to_html @course.do_during_class %></p>
    <br />
    <p class="light center">
      <% if @course.cost? && @course.cost > 0 %>
        Bookings are <span class="x1-25">$<%= @course.cost_formatted %></span>
      <% else %>
        This <%= @course.type %> is <strong>free to attend</strong>  
      <% end %>
    </p>
    <div class="fancy-header">
      <h3>New Booking</h3>
      <hr />
    </div> 
  </div>
    
  <div class="col-xs-12 col-md-8 col-md-offset-2 col-md-inset-2">
    <div class="part-question parts row text-center" style="display: block">
      <div class="col-xs-12">
        <p class="light">Who are you creating a booking for?</p>
      </div>
      <button data-target-part=".part-question" class="btn see_form set_single btn-default col-xs-12  col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">Single person</button>
      <button data-target-part=".part-question" class="btn see_number set_group btn-default col-xs-12 col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">A group of people</button>
    </div>
   
    <%= bootstrap_form_for(@booking_set, url: course_bookings_path, html: { method: :post, class: 'form-horizontal', role: 'form'}) do |f| %>   
      <div class="row">
        <div class="part-count parts col-xs-12">
          <%= f.input :count, as: :number_picker, label: "How many people?", input_html: {:'data-min' => 1,  value: 2 }, wrapper: :horizontal %>
          <br /><br />
          <div data-target-part=".part-count" class="btn btn-default see_form count_attendees col-xs-12 col-sm-8 col-sm-offset-2">
            Continue
          </div>
        </div>

        <div class="part-form parts col-xs-12">
          <%= f.error_notification %>
          <div id="attendees">
            <% f.object.bookings.unshift(Booking.new) %>
            <% template_done = false %>
            <% f.object.bookings.each do |booking| %>
              <% unless template_done %>
                <div id="attendee_template">
              <% end %>
                <div class="attendee">
                  <%= f.fields_for "bookings[]", booking do |bf| %>
                  
                    <%= bf.input :course_id, :as => :hidden, :input_html => { :value => @course.id } %>

                    <%= bf.input :name, as: :string, label: '<span class="small light grey">Attendee Name</small>', input_html: { class: 'form-control' } %>
                    
                    <%= bf.input :email, as: :string, label: '<span class="small light grey">Email - (Only enter if the attendee may manage booking themselves)</small>', input_html: { class: 'form-control' } %>

                    <%= bf.input :note_to_teacher, as: :text, label: '<span class="small light grey">Note to Teacher</small>', input_html: { class: 'form-control' } %>

                    <% if @course.custom_fields %>
                      <% @course.custom_fields.each do |field| %>
                        <%= bf.input :custom_fields, 
                            input_html: { 
                              class: ( field[:type] == 'string' || field[:type] == 'text' ? 'form-control' : ''),
                              name: "booking_set[bookings][][custom_fields][][#{field[:prompt]}]"+(field[:type]=='check_boxes' ? '[]' : ''), 
                              value: bf.object.custom_fields.is_a?(Hash) ? bf.custom_fields[field[:prompt]] : "" }, 
                            as: field[:type], 
                            label: field[:prompt], 
                            collection: field[:options], 
                            checked: bf.object.custom_fields.is_a?(Hash) ? bf.custom_fields[field[:prompt]] : "" %>
                      <% end %>
                    <% end #if custom_fields %>

                  <% end #fields_for %>
                  <div class="row">
                    <div class="prev_attendee btn btn-default col-xs-12  col-sm-5 col-sm-inset-2 col-md-4">Previous</div>

                    <div class="next_attendee btn btn-default col-xs-12 col-sm-5 col-sm-offset-2  col-md-4 col-md-offset-4">Next</div>
                  </div>

                </div>
              <% unless template_done %>
                </div>
                <% template_done = true %>
              <% end %>
            <% end #each booking %>
       

          </div>
        </div>

        <div class="part-summary parts">

          <div id="summary">

          </div>

          <div class="center">
            <% if policy(@course).admin? && @course.paid? %>
              <div class="alert-danger alert clearfix">
                <div class="light small col-xs-6">
                  Admin options
                </div>
                <div class="checkbox col-xs-6">
                  <label id="wavefees">
                    <input type="checkbox" id="wavefees" name="remove_fees" value="1" />
                    <span style="position:relative; bottom:10px;">Waive fees</span>
                  </label>
                </div>
              </div>
            <% end #policy %>
            
            
            <div class="checkbox col-xs-12">
              <label id="teaching_agreeterms" data-error-message="You must agree to the terms and conditions to continue">
                <input type="checkbox" id="booking_terms_and_conditions" value="1" />
                <span style="position:relative; bottom:10px;"> I agree to the <a data-toggle="modal" href="#termsModal">Terms and Conditions</a></span>
              </label>
            </div>
            <br />

            <%= f.submit :'Complete Booking', class: 'btn btn-primary col-xs-12 col-sm-8 col-sm-offset-2' %>
            
            <br /><br />
            
            <div class="btn btn-default back col-xs-12 col-sm-8 col-sm-offset-2">Back</div>

          </div>
        </div>
      </div>
    <% end #form %>

  </div>
</div>
<%= render 'terms' %>
