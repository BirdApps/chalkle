<div class="new_form_wrapper new_booking">
  <div class="col-md-8 col-xs-12 col-md-offset-2 col-md-inset-2">
    <p><%= to_html @course.do_during_class %></p>
    <br />
    <p class="light center">
      <% if @course.cost? && @course.cost > 0 %>
        Bookings are <span class="x1-25">$<%= @course.cost_formatted %></span>
      <% else %>
        This <%= @course.type %> is <strong>free to attend</strong>  
      <% end %>
    </p>
    <div class="fancy-header">
      <h3>New Booking</h3>
      <hr />
    </div> 
  </div>
    
  <div class="col-xs-12">
    <div class="part-question parts row text-center" data-prev="part-question" style="display: block">
      <div class="col-xs-12">
        <p class="light">Who are you creating a booking for?</p>
      </div>
      <button data-view=".part-question" class="btn see_form set_single btn-default col-xs-12  col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">Just me</button>
      <button data-view=".part-question" class="btn see_number set_group btn-default col-xs-12 col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">A group of people</button>
    </div>
   
    <%= bootstrap_form_for(@booking_set, url: course_bookings_path, html: { method: :post, class: 'form-horizontal', role: 'form'}) do |f| %>   
      <div class="row">
        <div data-prev="part-question" class="part-count parts col-xs-12">
          <%= f.input :count, as: :number_picker, label: "How many people?", input_html: {:'data-min' => 2,  value: 2 }, wrapper: :horizontal %>
          <br /><br />
          <button data-view=".part-count" class="btn btn-default see_form count_attendees col-xs-12 col-sm-8 col-sm-offset-2">
            Continue
          </button>
        </div>
        
        <div style="display:none">
          <% f.object.bookings.each do |booking| %>
            <div id="attendee_template">
              <div class="attendee">
                <%= f.fields_for booking do |bf| %>
                
                  <%= bf.input :course_id, :as => :hidden, :input_html => { :value => @course.id } %>

                  <%= bf.input :name, as: :string, label: '<span class="small light grey">Attendee Name</small>', input_html: { class: 'form-control' } %>
                  
                  <%= bf.input :note_to_teacher, as: :text, label: '<span class="small light grey">Note to Teacher</small>', input_html: { class: 'form-control' } %>

                  <% if @course.custom_fields %>
                    <% @course.custom_fields.each do |field| %>
                      <%= bf.input :custom_fields, 
                          input_html: { 
                            class: ( field[:type] == 'string' || field[:type] == 'text' ? 'form-control' : ''),
                            name: "custom_fields[#{field[:prompt]}]"+(field[:type]=='check_boxes' ? '[]' : ''), 
                            value: (params[:custom_fields].is_a?(Hash) ? params[:custom_fields][field[:prompt]] : '') }, 
                          as: field[:type], 
                          label: field[:prompt], 
                          collection: field[:options], 
                          checked: (params[:custom_fields].is_a?(Hash) ? params[:custom_fields][field[:prompt]] : '') %>
                    <% end %>
                  <% end #if custom_fields %>

                <% end #fields_for %>

                <button class="prev_attendee btn btn-default col-xs-12  col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">Previous</button>

                <button class="next_attendee btn btn-default col-xs-12 col-sm-8 col-sm-offset-2 col-sm-inset-2 col-md-4 col-md-offset-1 col-md-inset-1">Next</button>

              </div>
            </div>
          <% end #each booking %>
        </div>

        <div class="part-form parts col-xs-12">
          <%= f.error_notification %>
          <div id="attendees"></div>
        </div>

        <div class="part-summary parts">
          <div class="center">
            <% if policy(@course).admin? && @course.paid? %>
              <div class="alert-danger alert clearfix">
                <div class="light small col-xs-6">
                  Admin options
                </div>
                <div class="checkbox col-xs-6">
                  <label id="wavefees">
                    <input type="checkbox" id="wavefees" name="remove_fees" value="1" />
                    <span style="position:relative; bottom:10px;">Waive fees</span>
                  </label>
                </div>
              </div>
            <% end #policy %>
            
            
            <div class="checkbox col-xs-12">
              <label id="teaching_agreeterms" data-error-message="You must agree to the terms and conditions to continue">
                <input type="checkbox" id="booking_terms_and_conditions" value="1" />
                <span style="position:relative; bottom:10px;"> I agree to the <a data-toggle="modal" href="#termsModal">Terms and Conditions</a></span>
              </label>
            </div>
            <br />
            
            <input type="submit" value="Complete Booking" class="btn btn-primary col-xs-12 col-sm-8 col-sm-offset-2" />
            
            <br /><br />
            
            <button class="btn btn-default back col-xs-12 col-sm-8 col-sm-offset-2">Back</button>

          </div>
        </div>
      </div>
    <% end #form %>

  </div>
</div>
<%= render 'terms' %>
