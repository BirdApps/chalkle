- title @course.name
= content_for :header { 
  %meta{ property: "og:image", content: @course.course_upload_image.url(:large).to_s }
  %meta{ property: "og:image:secure_url", content: @course.course_upload_image.url(:large).to_s }
}

.page_header_panel
  .container
    %h1.page-title
      - if chalkler_signed_in?
        = "Welcome #{current_chalkler.name}"
      - else
        = "Welcome to chalkleÂ°"
.main_panel.container
  .row.with_browse_sidebar
    .col-sm-9.col-md-8{class: course_classes(@course, 'course_panel')}
      .masthead
        .masthead_contents
          -if @course.course_upload_image.url.present?
            =image_tag @course.course_upload_image.url(:large).to_s, alt: @course.name, class: 'course-image uploaded-course-image'
          %h2= @course.name

          .booking-actions
            - if chalkler_signed_in?
              - if current_chalkler.courses.where{bookings.status.eq 'yes'}.exists? @course
                %p.text-success
                  %strong You are attending
              - elsif @course.bookable?
                .btn.btn-primary= link_to 'Join this class', new_channel_course_booking_path(@channel, @course), :id => 'join-course'
            - elsif @course.bookable?
              .btn.btn-primary= link_to 'Join this class', new_channel_course_booking_path(@channel, @course), :id => 'join-course'

      .details
        .details_block
          .time_details
            .iconic_block.time>
              %i.fa.fa-clock-o
              = @course.start_at.strftime('%l:%M %p').strip
              .duration= pluralize(@course.duration / 60 / 60, "hour") if @course.duration

            .iconic_block.date
              %i.fa.fa-calendar
              .name= @course.start_at.strftime('%A').strip
              .day= @course.start_at.strftime('%d %B').strip
        .details_block
          .cost_and_location_details
            .iconic_block.price
              %i.fa.fa-money
              = @course.formatted_price
            - unless @course.venue.blank?
              .iconic_block.location
                %i.fa.fa-map-marker
                = @course.venue
        .details_block
          .attendance_details
            .iconic_block.availability
              - if @course.limited_spaces?
                - if @course.spaces_left?
                  %i.fa.fa-thumbs-up
                  = pluralize @course.spaces_left, 'spot'
                  left
                - else
                  %i.fa.fa-thumbs-down
                  fully booked!
              - else
                %i.fa.fa-check
                No size limit
            .iconic_block.attending
              %i.fa.fa-user
              = @course.attendance
              attending
      - if teacher = @course.teacher
        .teacher_details.highlighted_content
          .img_right
            = image_tag teacher.avatar.url, alt: teacher.name, class: 'avatar teacher_avatar'
            .text
              %h3
                Your Teacher:
                %span.teacher_name
                  = teacher.name
              .teacher-bio
                = simple_format teacher.bio
      .text_contents
        .course-description
          - unless @course.do_during_class.blank?
            .do_during_class
              %h3 What we are doing
              = simple_format @course.do_during_class
          - unless @course.learning_outcomes.blank?
            .learning_outcomes
              %h3 What you will learn
              = simple_format @course.learning_outcomes
          .notes
            - if @course.min_attendee.to_i > 0
              %h6 Note
              = "We require a minimum of #{@course.min_attendee} people for this class to go ahead. If the minimum number of attendees is not reached, a decision to cancel will be made 3 days before the class. If the class is cancelled, you will be notified via email with refund instructions."

      - if @course.channel
        .channel_details.highlighted_content
          .img_left
            .logo= channel_logo @course.channel
            .text
              %h3= @course.channel.name
              .description= @course.channel.short_description
              .channel_link= link_to "View more classes by #{@course.channel.name}", channel_path(@course.channel)

      -#= render :partial => 'course_details', :locals => { :course => @course }
      -#= render :partial => 'teacher_details', :locals => { :course => @course }

    .col-sm-3.col-md-4.hidden-xs.browse_sidebar
      = render partial: 'small_sidebar', locals: {week_courses: @week_courses}

:coffeescript
  $ ->
    signedIn = () ->
      if _.isString(_.find(document.cookie.split('; '), (a)-> return a == 'signed_in=1')) then true else false

    $('#join-course').click (e)->
      unless signedIn()
        e.preventDefault()

    unless signedIn()
      $('#join-course').popover
        placement: 'top'
        html: true
        title: 'Sign in to join a class'
        content: 'Please <a href="/chalklers/sign_in">sign in</a> or <a href="/chalklers/sign_up">create an account</a> to make a booking.'

    $('.with_browse_sidebar').equalize({equalize: 'min-height', reset: true})
    $('.course_panel .details').equalize({equalize: 'min-height', reset: true})
    $('.teacher_details .teacher-bio').readmore({
      maxHeight: 60
    })
