<% cache "_course_#{course.id}", skip_digest: true do %>
  <article class="course row">
    <div class="col-sm-2 flush-xs">
      <div class="porthole">
        <a href="<%= course.path %>" title="<%= course.name %>">
          <% if course.course_upload_image.present? %>
            <div class="img" style="background-image: url(<%= course.course_upload_image.url(:large).html_safe %>);">
            </div>
          <% else %>
            <%= image_tag(
              "categories/grey.png",
              alt: course.name,
              title: course.name,
              class: 'course_image'
            ) %>
          <% end %>
        </a>
      </div>
    </div>
    <div class="col-sm-10">
      <header class="clearfix">
        <div class="title-wrapper">
        <div class="availability-wrapper">
          <a href="<%= new_course_booking_path course.id %>" class="availability nowrap btn-3d bg-colour<%= course.best_colour_num %>">
            <%= course_call_to_action course %>
          </a>
        </div>
          <h3 class="title">
            <%= link_to course.name, channel_course_path(course.channel.url_name,course.url_name,course.id), { :class => "colour"+course.best_colour_num.to_s } %>
          </h3>
          <h5 class="category">
            <% unless course.category.nil? %>
              <%= link_to course.category.name, root_path(filter_params('topic', course.category.url_name)), { :class => "colour"+course.best_colour_num.to_s } %>
            <% else %>
              <br />
            <% end %>
          </h5>
        </div>
        
      </header>
      <div class="details clearfix">
        <a href="<%= channel_path(course.channel.url_name) %>" title="<%= course.channel.name %>" >
          <img class="channel-img pull-left" src=<%= course.channel.logo.url %> />
        </a>
        <div class="pull-left">
          <div class="grey upper smaller">Provided By</div>
          <%= link_to course.channel.name, channel_path(course.channel.url_name) %>
        </div>
        <div class="vertical-seperator pull-left hidden-xs"></div>
        <div class="pull-left">
          <div class="grey upper smaller">Your Teacher</div>
          <% if course.teacher  %>
            <%= link_to course.teacher.name, channel_channel_teacher_path(course.channel.url_name,course.teacher) %>
          <% else %>
            No teacher assigned
          <% end %>
        </div>
        <% unless course.published?  %>
          <div class="vertical-seperator pull-left hidden-xs"></div>
          <div class="margin-top-5 pull-left">
            <div class="alert alert-<%= course.status_color %> flush">
              <h4 class="warn-unpublished light small"><%= course.status %></h4>
            </div>
          </div>
        <% end %>
        <% if course.reviews? %> 
          <div class="reviews small grey">
            <span class="fa fa-heart"></span>
            <span class="pull-right text-right">
              <%= course.review_percent || '?' %>%
            </span>
            <div class="small">
              <%= course.reviews.count %> reviews
            </div>
          </div>
        <% end  %>
      </div>
      <footer>
        <span class="small grey">
          <span class="fa fa-clock-o"></span>
          <% if course.class? %>
            <%= day_ordinal_month course.start_at %>
          <% end %>
          <%= pretty_time_range course.start_at, course.end_at %>
          <span class="fa fa-map-marker"></span>
          <%= course.venue_address %>
        </span>
        <div class="cost pull-right">
          <% if course.cost? %>
            $<%= course.cost_formatted %>
          <% else %>
            FREE
          <% end %>
        </div>
      </footer>
    </div>
  </article>
<% end %>