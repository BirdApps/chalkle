%table
  %thead
    %tr
      %th Name
      %th Email
      %th Guests
      %th Status       
      %th Paid
      -if role!="super"
        %th Answers
      -if role=="super"
        %th Cost
        %th Booking
        %th Payment
      %th May cancel
      %th Cash
  %tbody
    -bookings.each do |b|
      %tr
        %td= link_to b.chalkler.name, admin_chalkler_path(b.chalkler)
        -if b.chalkler.meetup_id.present?
          %td= link_to b.chalkler.meetup_id, "http://www.meetup.com/" + channel_url.first + "/message/?recipientId=#{b.chalkler.meetup_id}"
        -elsif b.chalkler.email.present?
          %td= mail_to b.chalkler.email
        -else
          %td= "no contact"
        %td= b.guests
        %td= b.status
        %td= b.paid
        -if role!="super"
          %td
            =render "/admin/bookings/answers", :answers => b.answers if b.answers
        -if role=="super"
          %td= number_to_currency b.cost
          %td= link_to 'View', admin_booking_path(b) if can? :read, b
          -if b.reminder_email_choice
            -event_url = lesson.meetup_data.present? ? lesson.meetup_data["event_url"] : nil
            %td= link_to ( b.status=='no-show' ? 'No-show' : 'Reminder' ), "http://www.meetup.com/" + channel_url.first + "/message/?recipientId=#{b.chalkler.meetup_id}&subject=#{email_subject(b.chalkler.name,lesson.name)}&body=Hi+#{b.chalkler.name.split[0]},#{reminder_email_content(b.reminder_email_choice, lesson.name, (lesson.meetup_id.present? ? lesson.meetup_id : ""),lesson.cost, event_url)}"
          -elsif b.paid
            %td= link_to 'View payment', admin_payment_path(b.payment) if can? :read, b
          -else
            %td= ""
        -if lesson.class_may_cancel
          %td= link_to 'Email them', "http://www.meetup.com/" + channel_url.first + "/message/?recipientId=#{b.chalkler.meetup_id}&subject=#{email_subject(b.chalkler.name,lesson.name)}&body=Hi+#{b.chalkler.name.split[0]},#{may_cancel_email(lesson.name, lesson.min_attendee)}"
        -else
          %td= ""
        -if (b.cost.present? ? b.cost : 0) > 0 && b.paid != true
          %td= link_to "Pay #{number_to_currency b.cost}", record_cash_payment_admin_booking_path(b)
